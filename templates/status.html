<!DOCTYPE html>
<html>
<head>
    <title>VM デプロイ状況</title>
</head>
<body>
    <h1>VM デプロイ状況</h1>
    <div id="status-message">処理中です...</div>
    <div id="result"></div>

    <script>
        const jobName = "{{ job_name }}";
        const statusMessage = document.getElementById('status-message');
        const resultDiv = document.getElementById('result');

        function checkStatus() {
            fetch(`/api/job-status/${jobName}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'succeeded') {
                        statusMessage.textContent = '完了しました！';
                        resultDiv.innerHTML = `<p>VMは <a href="${data.url}" target="_blank">${data.url}</a> にて起動しています。</p>`;
                    } else if (data.status === 'failed' || data.status === 'error') {
                        statusMessage.textContent = 'デプロイに失敗しました。';
                        resultDiv.textContent = `エラー: ${data.message}`;
                    } else {
                        // 処理中
                        statusMessage.textContent = data.message;
                        setTimeout(checkStatus, 5000); // 5秒後に再チェック
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    statusMessage.textContent = 'エラーが発生しました。';
                });
        }

        window.onload = checkStatus;
    </script>
</body>
</html>
