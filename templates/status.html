<!DOCTYPE html>
<html>
<head>
    <title>VM デプロイ状況</title>
</head>
<body>
    <h1>VM デプロイ状況</h1>
    <div id="status-message">処理中です...</div>
    <pre id="logs-container"></pre>

    <script>
        const jobName = "{{ job_name }}";
        const statusMessage = document.getElementById('status-message');
        const logsContainer = document.getElementById('logs-container');
        let pollingInterval;

        function checkStatus() {
            fetch(`/api/job-logs/${jobName}`)
                .then(response => response.text())
                .then(logs => {
                    logsContainer.textContent = logs;
                    // Jobが完了したらポーリングを停止
                    if (logs.includes('VM is ready') || logs.includes('VM network not available')) {
                        clearInterval(pollingInterval);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    statusMessage.textContent = 'エラーが発生しました。';
                    clearInterval(pollingInterval);
                });
        }

        window.onload = function() {
            // ログのポーリングを開始
            pollingInterval = setInterval(checkStatus, 5000);
        };
    </script>
</body>
</html>
